{"createdAt":"2025-02-23T10:48:44.770Z","updatedAt":"2025-02-23T20:02:03.000Z","id":"Ieo9EaiqhhE6mFJr","name":"WA chatbot using vectorDB - Multiazienda - Consultazione","active":true,"nodes":[{"parameters":{"updates":["messages"]},"id":"908a2335-3ecc-4d32-ac64-781974e3d936","name":"WhatsApp Trigger","type":"n8n-nodes-base.whatsAppTrigger","position":[-1320,340],"webhookId":"4a151440-d6be-4dd0-9636-599618e91ee3","typeVersion":1,"credentials":{"whatsAppTriggerApi":{"id":"g70JAxZMbNtIOFhe","name":"WhatsApp OAuth account"}}},{"parameters":{"model":"gpt-4o-2024-08-06","options":{}},"id":"69b18dcc-60d0-40f3-99ad-a8e75a931717","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[80,440],"typeVersion":1,"credentials":{"openAiApi":{"id":"KGWrubCDJoZ8doQM","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"=whatsapp-75-{{ $('System command (/)?').item.json.messages[0].text.body }}","contextWindowLength":7},"id":"92e514da-cf86-4006-af82-21403460f703","name":"Window Buffer Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[240,440],"typeVersion":1.2},{"parameters":{"name":"query_product_brochure","description":"Call this tool to query the product brochure. Valid for the year 2024."},"id":"b948a6ee-46e9-4635-be23-5e923a3a5a70","name":"Vector Store Tool","type":"@n8n/n8n-nodes-langchain.toolVectorStore","position":[380,380],"typeVersion":1},{"parameters":{"model":"gpt-4o-2024-08-06","options":{}},"id":"57d55415-9d51-43cd-8527-7707be7c1b7d","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[700,620],"typeVersion":1,"credentials":{"openAiApi":{"id":"KGWrubCDJoZ8doQM","name":"OpenAi account"}}},{"parameters":{"operation":"send","phoneNumberId":"577068745482238","recipientPhoneNumber":"={{ $('WhatsApp Trigger').item.json.messages[0].from }}","textBody":"={{ $json.output }}","additionalFields":{"previewUrl":false},"requestOptions":{}},"id":"5671ef00-ea81-46c6-912e-cfbf23f63110","name":"Reply To User","type":"n8n-nodes-base.whatsApp","position":[700,200],"typeVersion":1,"credentials":{"whatsAppApi":{"id":"qJWIa1odbFYsqLxy","name":"WhatsApp account"}}},{"parameters":{"content":"### Want to handle all message types?\nCheck out my other WhatsApp template in my creator page! https://n8n.io/creators/jimleuk/","height":92,"width":338},"id":"04dfe9e4-cf95-4d4a-a724-5ffdf42da571","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[-1100,580],"typeVersion":1},{"parameters":{"promptType":"define","text":"={{ $('System command (/)?').item.json.messages[0].text.body }}","options":{"systemMessage":"={{ $json['System prompt'] }}"}},"id":"528b665e-eaa9-432d-80a3-de8815f076a0","name":"AI Sales Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[140,200],"typeVersion":1.6},{"parameters":{"pineconeIndex":{"__rl":true,"value":"={{ $('Parametri catalogo').item.json.ID.toString() }}","mode":"id"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1,"position":[340,540],"id":"965fa85b-4d3c-4d41-a150-a7f5707b83e3","name":"Pinecone Vector Store","credentials":{"pineconeApi":{"id":"1UV60CZEppVg4tvU","name":"PineconeApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[360,740],"id":"bdab465c-2e78-40b4-b8a1-dbc1add054dc","name":"Embeddings OpenAI1","credentials":{"openAiApi":{"id":"KGWrubCDJoZ8doQM","name":"OpenAi account"}}},{"parameters":{"operation":"send","phoneNumberId":"577068745482238","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"={{ $json.message }}","additionalFields":{"previewUrl":false},"requestOptions":{}},"id":"d7eb6d32-9ce9-4229-b5e9-2baa6429e0ff","name":"Invia istruzioni","type":"n8n-nodes-base.whatsApp","position":[640,-360],"typeVersion":1,"credentials":{"whatsAppApi":{"id":"qJWIa1odbFYsqLxy","name":"WhatsApp account"}}},{"parameters":{"functionCode":"const header = \"Puoi cambiare i dati di riferimento inviando i seguenti comandi:\";\nconst footer = \"Solo la barra e il numero. Grazie.\";\nconst commands = items.map(item => item.json.formatted).join(\"\\n\");\n\nreturn [{ json: { message: `${header}\\n${commands}\\n${footer}` } }];"},"id":"543eb63d-deb8-459e-93f7-ce07d9a2a0b9","name":"Create Message","type":"n8n-nodes-base.function","position":[400,-360],"typeVersion":1},{"parameters":{"documentId":{"__rl":true,"value":"1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ","mode":"list","cachedResultName":"Chatbot_sheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"BasiDati","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit#gid=0"},"options":{}},"id":"110323ed-359c-4982-8869-baa3efb26f27","name":"Google Sheets - Get Rows1","type":"n8n-nodes-base.googleSheets","position":[-40,-360],"typeVersion":4.5,"credentials":{"googleSheetsOAuth2Api":{"id":"9rbmrZhUfdBgrlBn","name":"Google Sheets account"}}},{"parameters":{"functionCode":"return items.map(item => ({ json: { formatted: `/${item.json[Object.keys(item.json)[1]]} - ${item.json[Object.keys(item.json)[4]]}` } }));"},"id":"d25f2dab-eee2-4b53-b254-58c1640a1a0b","name":"Format Data1","type":"n8n-nodes-base.function","position":[180,-360],"typeVersion":1},{"parameters":{"operation":"send","phoneNumberId":"577068745482238","recipientPhoneNumber":"={{ $('WhatsApp Trigger').item.json.messages[0].from }}","textBody":"=Purtroppo non sono in grado di elaborare contenuti diversi dal testo. Grazieper la comprensione!","additionalFields":{"previewUrl":false},"requestOptions":{}},"id":"c667c917-76c6-4821-bfb4-490bd1942f2d","name":"Solo testo","type":"n8n-nodes-base.whatsApp","position":[-640,520],"typeVersion":1,"credentials":{"whatsAppApi":{"id":"qJWIa1odbFYsqLxy","name":"WhatsApp account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d76ef532-24fa-4129-96a2-a705c4ee60c7","leftValue":"={{ $json.messages[0].text.body }}","rightValue":"/","operator":{"type":"string","operation":"startsWith"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-900,160],"id":"aeb3a407-3bba-43b6-9274-4704aed7dd40","name":"System command (/)?"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.messages[0].type }}","rightValue":"text"}]},"renameOutput":true,"outputKey":"Supported"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"89971d8c-a386-4e77-8f6c-f491a8e84cb6","operator":{"type":"string","operation":"notEquals"},"leftValue":"={{ $json.messages[0].type }}","rightValue":"text"}]},"renameOutput":true,"outputKey":"Not Supported"}]},"options":{}},"id":"fd72f362-d447-40c1-9f04-717b57c45891","name":"Verifica tipo messaggi","type":"n8n-nodes-base.switch","position":[-1160,340],"typeVersion":3.2},{"parameters":{"documentId":{"__rl":true,"value":"1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ","mode":"list","cachedResultName":"Chatbot_sheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"BasiDati","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"ID","lookupValue":"={{ $json['Quale catalogo?'] }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-200,200],"id":"64ad6739-3f5b-48df-a841-7c8c07b01759","name":"Parametri catalogo","credentials":{"googleSheetsOAuth2Api":{"id":"9rbmrZhUfdBgrlBn","name":"Google Sheets account"}}},{"parameters":{"documentId":{"__rl":true,"value":"1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ","mode":"list","cachedResultName":"Chatbot_sheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1901732273,"mode":"list","cachedResultName":"DatiBase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit#gid=1901732273"},"options":{"returnFirstMatch":true}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-420,200],"id":"2b51cfd9-e55b-4385-8113-768402555fbe","name":"Num. catalogo?","credentials":{"googleSheetsOAuth2Api":{"id":"9rbmrZhUfdBgrlBn","name":"Google Sheets account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4f0d8b57-ca0e-4b2d-8ce8-68120c2976fc","leftValue":"={{ $json.messages[0].text.body }}","rightValue":"/help","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-380,-340],"id":"875068d7-9e4e-4aa4-88c4-0d6ceb5529c0","name":"Help request"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"055b7ebd-42a6-474e-bc7a-c1587e765e10","leftValue":"={{ $json.messages[0].text.body.substring(1) }}","rightValue":"[1-4]","operator":{"type":"string","operation":"regex"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-60,-140],"id":"1a024305-9403-40b5-b632-67af8925b640","name":"Change catalogue"},{"parameters":{"operation":"send","phoneNumberId":"577068745482238","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"=I miei nuovi dati di riferimento riguardano \"{{ $json['Azienda in demo'] }}\"","additionalFields":{"previewUrl":false},"requestOptions":{}},"id":"479a5f61-0d80-4b18-ae1a-b751ff8d797a","name":"Invia istruzioni1","type":"n8n-nodes-base.whatsApp","position":[640,-140],"typeVersion":1,"credentials":{"whatsAppApi":{"id":"qJWIa1odbFYsqLxy","name":"WhatsApp account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ","mode":"list","cachedResultName":"Chatbot_sheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1901732273,"mode":"list","cachedResultName":"DatiBase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit#gid=1901732273"},"columns":{"mappingMode":"defineBelow","value":{"row_number":"2","Quale catalogo?":"={{ $json.messages[0].text.body.substring(1).toNumber() }}"},"matchingColumns":["row_number"],"schema":[{"id":"Quale catalogo?","displayName":"Quale catalogo?","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[200,-140],"id":"ced69bc6-be4d-416c-abd5-ca7c84529c5b","name":"Aggiorna num. catalogo","credentials":{"googleSheetsOAuth2Api":{"id":"9rbmrZhUfdBgrlBn","name":"Google Sheets account"}}},{"parameters":{"documentId":{"__rl":true,"value":"1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ","mode":"list","cachedResultName":"Chatbot_sheet","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"BasiDati","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1N8u548ImesVpDMrAy1EA-DrOA2-mshekrbgP47l3ZXQ/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"ID","lookupValue":"={{ $json['Quale catalogo?'] }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[400,-140],"id":"b2349787-1240-4d90-8034-3ef37e68aae2","name":"Recuper info","credentials":{"googleSheetsOAuth2Api":{"id":"9rbmrZhUfdBgrlBn","name":"Google Sheets account"}}},{"parameters":{"operation":"send","phoneNumberId":"577068745482238","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"=Mi spiace, ma il comando è sconosciuto..","additionalFields":{"previewUrl":false},"requestOptions":{}},"id":"525e053a-475e-40f6-87d9-0e2bb64953e4","name":"Invia istruzioni2","type":"n8n-nodes-base.whatsApp","position":[200,40],"typeVersion":1,"credentials":{"whatsAppApi":{"id":"qJWIa1odbFYsqLxy","name":"WhatsApp account"}}}],"connections":{"AI Sales Agent":{"main":[[{"node":"Reply To User","type":"main","index":0}]]},"WhatsApp Trigger":{"main":[[{"node":"Verifica tipo messaggi","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Sales Agent","type":"ai_languageModel","index":0}]]},"Vector Store Tool":{"ai_tool":[[{"node":"AI Sales Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Vector Store Tool","type":"ai_languageModel","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"AI Sales Agent","type":"ai_memory","index":0}]]},"Pinecone Vector Store":{"ai_vectorStore":[[{"node":"Vector Store Tool","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Invia istruzioni":{"main":[[]]},"Create Message":{"main":[[{"node":"Invia istruzioni","type":"main","index":0}]]},"Google Sheets - Get Rows1":{"main":[[{"node":"Format Data1","type":"main","index":0}]]},"Format Data1":{"main":[[{"node":"Create Message","type":"main","index":0}]]},"System command (/)?":{"main":[[{"node":"Help request","type":"main","index":0}],[{"node":"Num. catalogo?","type":"main","index":0}]]},"Verifica tipo messaggi":{"main":[[{"node":"System command (/)?","type":"main","index":0}],[{"node":"Solo testo","type":"main","index":0}]]},"Num. catalogo?":{"main":[[{"node":"Parametri catalogo","type":"main","index":0}]]},"Parametri catalogo":{"main":[[{"node":"AI Sales Agent","type":"main","index":0}]]},"Help request":{"main":[[{"node":"Google Sheets - Get Rows1","type":"main","index":0}],[{"node":"Change catalogue","type":"main","index":0}]]},"Change catalogue":{"main":[[{"node":"Aggiorna num. catalogo","type":"main","index":0}],[{"node":"Invia istruzioni2","type":"main","index":0}]]},"Aggiorna num. catalogo":{"main":[[{"node":"Recuper info","type":"main","index":0}]]},"Recuper info":{"main":[[{"node":"Invia istruzioni1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"00a1c904-a332-48e0-948a-3666bdf41c00","triggerCount":2,"tags":[{"createdAt":"2025-02-12T01:25:44.824Z","updatedAt":"2025-02-12T01:25:44.824Z","id":"bzJZk40lpXglcXDs","name":"CHAT"},{"createdAt":"2025-02-10T13:32:48.613Z","updatedAt":"2025-02-23T19:53:15.863Z","id":"k5fZTQAhTgrJYO8g","name":"AD USO DEMO"},{"createdAt":"2025-02-17T23:26:27.504Z","updatedAt":"2025-02-19T15:58:40.522Z","id":"tL7B60od2zY9lf8X","name":"IN PRODUZIONE!"}]}