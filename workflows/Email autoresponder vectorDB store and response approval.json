{"createdAt":"2025-02-19T15:37:41.063Z","updatedAt":"2025-02-20T11:06:55.000Z","id":"IET8pVfE36lo9Wtw","name":"Email autoresponder vectorDB store and response approval","active":false,"nodes":[{"parameters":{"options":{}},"id":"b76c9f3a-5be7-4253-b836-621c12aa3048","name":"Email Trigger (IMAP)","type":"n8n-nodes-base.emailReadImap","position":[40,580],"typeVersion":2},{"parameters":{"html":"={{ $json.textHtml }}","options":{}},"id":"59b00571-0844-4da8-a650-1fe184ac40d6","name":"Markdown","type":"n8n-nodes-base.markdown","position":[260,580],"typeVersion":1},{"parameters":{"model":{"__rl":true,"mode":"list","value":"deepseek/deepseek-r1:free","cachedResultName":"deepseek/deepseek-r1:free"},"options":{}},"id":"bb11ab79-14f0-49d3-84da-d75e97fe47b0","name":"DeepSeek R1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[460,760],"typeVersion":1.2},{"parameters":{"fromEmail":"={{ $('Email Trigger (IMAP)').item.json.to }}","toEmail":"={{ $('Email Trigger (IMAP)').item.json.from }}","subject":"=Re: {{ $('Email Trigger (IMAP)').item.json.subject }}","html":"={{ $('Write email').item.json.output }}","options":{}},"id":"aaf4f075-1eee-441d-aae7-2d6e8fee241a","name":"Send Email","type":"n8n-nodes-base.emailSend","position":[2060,560],"webhookId":"f84fcde7-6aac-485a-9a08-96a35955af49","typeVersion":2.1},{"parameters":{"mode":"retrieve-as-tool","toolName":"company_knowladge_base","toolDescription":"Extracts information regarding the request made.","qdrantCollection":{"__rl":true,"mode":"id","value":"=COLLECTION"},"includeDocumentMetadata":false,"options":{}},"id":"9dd4a2ce-4f45-4090-8af0-ff2e54095ce5","name":"Qdrant Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","position":[1400,880],"typeVersion":1},{"parameters":{"options":{}},"id":"f078ad5c-a0d8-43d2-8c82-6d926efae62f","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[1400,1060],"typeVersion":1.2},{"parameters":{"operationMode":"nodeInputBinary","options":{"binaryDataKey":"={{ $json.data }}","summarizationMethodAndPrompts":{"values":{"combineMapPrompt":"=Write a concise summary of the following in max 100 words:\n\n\"{{ $json.data }}\"\n\nDo not enter the total number of words used.","prompt":"=Write a concise summary of the following in max 100 words :\n\n\"{{ $json.data }}\"\n\nDo not enter the total number of words used."}}}},"id":"ec2dbe4e-d83d-43f0-bfb2-2b87590d056d","name":"Email Summarization Chain","type":"@n8n/n8n-nodes-langchain.chainSummarization","position":[480,580],"typeVersion":2},{"parameters":{"promptType":"define","text":"=Write the text to reply to the following email:\n\n{{ $('Email Summarization Chain').item.json.response.text }}","hasOutputParser":true,"options":{"systemMessage":"You are an expert at answering emails. You need to answer them professionally based on the information you have. This is a business email. Be concise and never exceed 100 words. Only the body of the email, not create the subject.\n\nIt must be in HTML format and you can insert (if you think it is appropriate) only HTML characters such as <br>, <b>, <i>, <p> where necessary."}},"id":"db22403e-cb15-4d41-af55-5ace2c35675e","name":"Write email","type":"@n8n/n8n-nodes-langchain.agent","position":[1200,580],"typeVersion":1.7},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini","cachedResultName":"gpt-4o-mini"},"options":{}},"id":"d8da904f-78c7-4c0e-ab41-fddeba3439c6","name":"OpenAI","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[1200,880],"typeVersion":1.2},{"parameters":{"assignments":{"assignments":[{"id":"759dc0f9-f582-492c-896c-6426f8410127","name":"email","type":"string","value":"={{ $json.response.text }}"}]},"options":{}},"id":"3c3c8398-546e-45b4-b211-74777d172421","name":"Set Email","type":"n8n-nodes-base.set","position":[980,580],"typeVersion":3.4},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"5c377c1c-43c6-45e7-904e-dbbe6b682686","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $json.data.approved }}","rightValue":"true"}]},"options":{"ignoreCase":false}},"id":"c14ec1e4-fad0-4a66-86c7-908ddbdfc48f","name":"Approve?","type":"n8n-nodes-base.if","position":[1780,580],"typeVersion":2.2},{"parameters":{"content":"# Main Flow\n\n## Preliminary step:\nCreate a vector database on Qdrant and tokenize the documents useful for generating a response\n\n\n## How it works\nThis workflow is designed to automate the process of handling incoming emails, summarizing their content, generating appropriate responses with RAG, and obtaining approval (YES/NO button) before sending replies.\n\nThis workflow is designed to handle general inquiries that come in via corporate email via IMAP and generate responses using RAG. You can quickly integrate Gmail and Outlook via the appropriate trigger nodes","height":420,"width":580,"color":3},"id":"8f3a8f6e-8c82-472b-a123-e8758d983c63","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1},{"parameters":{"content":"Convert email to Markdown format for better understanding of LLM models","height":240},"id":"069f402a-f990-4b45-aa6b-7d86220feb78","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[180,500],"typeVersion":1},{"parameters":{"content":"Chain that summarizes the received email","height":240,"width":320},"id":"bce6518f-62a1-497d-b3bd-42e8081c8649","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[460,500],"typeVersion":1},{"parameters":{"content":"Agent that retrieves business information from a vector database and processes the response","height":240,"width":340},"id":"2d5e772a-7809-43c2-b4f9-d169a675aa30","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[1160,500],"typeVersion":1},{"parameters":{"operation":"sendAndWait","sendTo":"YOUR GMAIL ADDRESS","subject":"=[Approval Required]  {{ $('Email Trigger (IMAP)').item.json.subject }}","message":"=<h3>MESSAGE</h3>\n{{ $('Email Trigger (IMAP)').item.json.textHtml }}\n\n<h3>AI RESPONSE</h3>\n{{ $json.output }}","approvalOptions":{"values":{"approvalType":"double"}},"options":{}},"id":"379ff00b-47a6-46b1-aae0-6646272612f3","name":"Send Draft","type":"n8n-nodes-base.gmail","position":[1560,580],"webhookId":"d6dd2e7c-90ea-4b65-9c64-523d2541a054","typeVersion":2.1},{"parameters":{"content":"## IMPORTANT\n\nFor the \"Send Draft\" node, you need to send the draft email to a Gmail address because it is the only one that allows the \"Send and wait for response\" function.","height":360,"color":4},"id":"8df6bc03-375e-4722-8b7c-d5427346b56b","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[1520,380],"typeVersion":1}],"connections":{"OpenAI":{"ai_languageModel":[[{"node":"Write email","type":"ai_languageModel","index":0}]]},"Approve?":{"main":[[{"node":"Send Email","type":"main","index":0}],[{"node":"Set Email","type":"main","index":0}]]},"Markdown":{"main":[[{"node":"Email Summarization Chain","type":"main","index":0}]]},"Set Email":{"main":[[{"node":"Write email","type":"main","index":0}]]},"Send Draft":{"main":[[{"node":"Approve?","type":"main","index":0}]]},"DeepSeek R1":{"ai_languageModel":[[{"node":"Email Summarization Chain","type":"ai_languageModel","index":0}]]},"Write email":{"main":[[{"node":"Send Draft","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Qdrant Vector Store":{"ai_tool":[[{"node":"Write email","type":"ai_tool","index":0}]]},"Email Trigger (IMAP)":{"main":[[{"node":"Markdown","type":"main","index":0}]]},"Email Summarization Chain":{"main":[[{"node":"Set Email","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"14732dfd-0a7f-4f66-94dc-88d736430db6","triggerCount":0,"tags":[{"createdAt":"2025-02-12T00:06:31.183Z","updatedAt":"2025-02-16T12:09:52.918Z","id":"RAEtntqG5GvQKAMI","name":"AD USO INTERNO"},{"createdAt":"2025-02-11T23:59:41.483Z","updatedAt":"2025-02-14T16:18:26.979Z","id":"dzhL8PxGOvRSKz2J","name":"ANCORA IN TEST"},{"createdAt":"2025-02-19T15:37:50.479Z","updatedAt":"2025-02-19T15:38:16.192Z","id":"fve3rVr1x3p4Bx1y","name":"EMAIL"}]}