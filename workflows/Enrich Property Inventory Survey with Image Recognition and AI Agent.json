{"createdAt":"2025-02-12T01:06:07.253Z","updatedAt":"2025-02-12T01:27:35.000Z","id":"N1DZVOpV5TI8x05q","name":"Enrich Property Inventory Survey with Image Recognition and AI Agent","active":false,"nodes":[{"parameters":{},"id":"fbfa6933-d9df-4ec1-8e61-75e36d6eea1d","name":"When clicking \"Test workflow\"","type":"n8n-nodes-base.manualTrigger","position":[-800,280],"typeVersion":1},{"parameters":{"model":"gpt-4o","options":{"temperature":0}},"id":"d08b2405-f0e6-4349-aae1-88bc2f02c46b","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[100,420],"typeVersion":1},{"parameters":{"operation":"search","base":{"__rl":true,"mode":"list","value":"appbgxPBurOmQK3E7","cachedResultUrl":"https://airtable.com/appbgxPBurOmQK3E7","cachedResultName":"Building Inventory Survey Example"},"table":{"__rl":true,"mode":"id","value":"tblEHkoTvKpa4Aa0Q"},"filterByFormula":"AND(Image!=\"\", AI_status=FALSE())","returnAll":false,"options":{}},"id":"628283cf-ad2b-4859-8eb2-646656b18702","name":"Get Applicable Rows","type":"n8n-nodes-base.airtable","position":[-620,280],"typeVersion":2},{"parameters":{},"id":"359660f8-4a79-465a-80a0-05cdaf53c7db","name":"Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","position":[140,980],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"7263764b-8409-4cea-8db3-3278dd7ef9d8","name":"=route","type":"string","value":"={{ $json.route }}"},{"id":"55c3b207-2e98-4137-8413-f72cbff17986","name":"query","type":"string","value":"={{ $json.query }}"},{"id":"6eb873de-3c3a-4135-9dc0-1d441c63647c","name":"","type":"string","value":""}]},"options":{}},"id":"e1ef289b-874a-493e-8863-3c5cb162afe3","name":"Edit Fields","type":"n8n-nodes-base.set","position":[300,980],"typeVersion":3.3},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"response\": {\n    \"ok\": false,\n    \"error\": \"The requested tool was not found or the service may be unavailable. Do not retry.\"\n  }\n}\n","options":{}},"id":"ca2daef3-7e28-4cd7-99cd-aa5f48c89147","name":"Fallback Response","type":"n8n-nodes-base.set","position":[460,1120],"typeVersion":3.3},{"parameters":{"url":"https://serpapi.com/search.json","authentication":"predefinedCredentialType","nodeCredentialType":"serpApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"engine","value":"google_reverse_image"},{"name":"image_url","value":"={{ $json.query }}"}]},"options":{}},"id":"65356e4c-15b4-4c20-8636-df415153e8dd","name":"SERP Google Reverse Image API","type":"n8n-nodes-base.httpRequest","position":[740,800],"typeVersion":4.2},{"parameters":{"assignments":{"assignments":[{"id":"de99a504-713f-4c78-8679-08139b2def31","name":"response","type":"string","value":"={{ JSON.stringify($json.image_results.map(x => ({ position: x.position, title: x.title, link: x.link, description: x.snippet }))) }}"}]},"options":{}},"id":"35bccacd-d8a2-4f67-8075-a16e6a71b95a","name":"Reverse Image Search Response","type":"n8n-nodes-base.set","position":[920,800],"typeVersion":3.3},{"parameters":{"name":"reverse_image_search","description":"Call this tool to perform a reverse image search. Reverse image searches return urls where similar looking products exists. Fetch the returned urls to gather more information. This tool requires the following object request body.\n```\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"image_url\": { \"type\": \"string\" },\n   }\n}\n```\nimage_url should be an absolute URL to the image.","workflowId":"={{ $workflow.id }}","fields":{"values":[{"name":"route","stringValue":"serp.google_reverse_image"}]}},"id":"9e6b44c1-8743-47d8-a00c-ee036219d6fa","name":"Reverse Image Search Tool","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[180,580],"typeVersion":1.1},{"parameters":{"method":"POST","url":"https://api.firecrawl.dev/v0/scrape","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"url","value":"={{ $json.query }}"}]},"options":{}},"id":"8067fd63-de16-4423-9cec-3af5b19dc4cd","name":"Firecrawl Scrape API","type":"n8n-nodes-base.httpRequest","position":[740,1140],"typeVersion":4.2},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"a15a164f-d0c5-478f-8b27-f3d51746c214","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $json.success }}","rightValue":""}]},"options":{}},"id":"9d680440-834b-44c0-9491-bd73e6df4ed3","name":"Scrape Success?","type":"n8n-nodes-base.if","position":[900,1140],"typeVersion":2},{"parameters":{"assignments":{"assignments":[{"id":"7db5c81f-de90-40e1-8086-3f13d40451c7","name":"response","type":"string","value":"={{ $json.data.markdown.substring(0, 3000) }}"}]},"options":{}},"id":"57d49203-4580-427f-a50c-7b8303cc098e","name":"Firecrawl Scrape Success Response","type":"n8n-nodes-base.set","position":[1060,1140],"typeVersion":3.3},{"parameters":{"assignments":{"assignments":[{"id":"e691d86a-d366-44a2-baa6-3dba42527f6e","name":"response","type":"string","value":"{ error: \"Unable to scrape website due to unknown error. Do not retry.\" }"}]},"options":{}},"id":"75aed77a-d476-4830-9beb-fcf3b9676c11","name":"Firecrawl scrape Error Response","type":"n8n-nodes-base.set","position":[1060,1300],"typeVersion":3.3},{"parameters":{"name":"webpage_url_scraper_tool","description":"Call this tool to retrieve page contents of a url.\n```\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"url\": { \"type\": \"string\" },\n   }\n}\n```\nurl should be an absolute URL.","workflowId":"={{ $workflow.id }}","fields":{"values":[{"name":"route","stringValue":"firecrawl.scrape"}]}},"id":"c408b4b1-1c9a-4d4f-b552-e0d375fdd4b2","name":"Firecrawl Web Scaper Tool","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[320,580],"typeVersion":1.1},{"parameters":{"jsonSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"title\": { \"type\": \"string\" },\n    \"description\": { \"type\": \"string\" },\n    \"model\": { \"type\": \"string\" },\n    \"material\": { \"type\": \"string\" },\n    \"color\": { \"type\": \"string\" },\n    \"condition\": { \"type\": \"string\" }\n  }\n}"},"id":"4f86d5e1-3c32-4a54-b259-3b7673b1f829","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","position":[380,420],"typeVersion":1.1},{"parameters":{"content":"## 1. Use Airtable to Capture Survey Photos\n[Read more about AirTable](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.airtable)\n\nTo enable this workflow, we need a database where we can retreive the title and photo to analyse and write the generate values back to. Airtable is perfect for this since it has a robust API we can work with.\n\nFor this demo, we'll manually trigger but this can be changed for forms or other triggers.","height":495.4071184783251,"width":402.5984702109446,"color":7},"id":"17b61c36-8100-4ac1-a20e-2457de456dc1","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-860,-20],"typeVersion":1},{"parameters":{"content":"## 2. Use AI Vision Model to Analyse the Photo.\n[Read more about OpenAI Vision](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-langchain.openai)\n\nWe'll use OpenAi vision model to create a detailed description of the product in the photo. We split this step from the agent because it uses an image model rather than the usual text-based one.","height":428.4787925736586,"width":359.40869874940336,"color":7},"id":"ab86db73-5e27-4d0d-b4a3-b9fc6696d215","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-420,80],"typeVersion":1},{"parameters":{"content":"## 3. Build an AI Agent who Searches the Internet\n[Read more about OpenAI Agents](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-langchain.openai)\n\nThis AI Agent has the ability to perform reverse image searches using our captured photos as well visit external webpages in order to obtain accurate product names and attributes. The Agent along with the tools might mimic what the average human user would carry out the same task.\n\n* For reverse image search, we're using SERP API service however we won't use the built-in SERP node as we need to specify custom parameters. \n* For scraping, we'll use [Firecrawl](https://www.firecrawl.dev/) as this service also helps to parse and return the page as markdown which is more efficient.","height":803.956942672397,"width":593.0683948010671,"color":7},"id":"ab6a99a0-2a23-42f4-8cb8-373aa27e6394","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[-20,-60],"typeVersion":1},{"parameters":{"content":"## 4. Overwrite our Rows with Enriched Results\n\nAnd Viola! Our AI agent has potentially saved hours of manual data entry work for our surveyor. This technique can be used for many other usecases.","height":397.7168664109706,"width":373.3601237414979,"color":7},"id":"b15316ec-9e03-40e7-be0d-fd34ffcd66b7","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[620,100],"typeVersion":1},{"parameters":{"content":"## 5. Using the Custom Workflow Tool\n[Read more about Workflow Tools](https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.toolworkflow)\n\nAI Agents rely on Tools to make decisions and become exponentially more powerful the more tools they have. A common pattern to manage multiple tools is to create a routing system for tools using the API pattern.","height":490.7010880746526,"width":554.6092633638649,"color":7},"id":"934a38ff-b8e4-4669-8c47-f8adecbe72ad","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[80,800],"typeVersion":1},{"parameters":{"operation":"update","base":{"__rl":true,"mode":"list","value":"appbgxPBurOmQK3E7","cachedResultUrl":"https://airtable.com/appbgxPBurOmQK3E7","cachedResultName":"Building Inventory Survey Example"},"table":{"__rl":true,"mode":"id","value":"tblEHkoTvKpa4Aa0Q"},"columns":{"value":{"id":"={{ $('Get Applicable Rows').item.json.id }}","Color":"={{ $json.output.output.color }}","Model":"={{ $json.output.output.model }}","Title":"={{ $json.output.output.title }}","Material":"={{ $json.output.output.material }}","AI_status":true,"Condition":"={{ $json.output.output.condition }}","Description":"={{ $json.output.output.description }}"},"schema":[{"id":"id","type":"string","display":true,"removed":false,"readOnly":true,"required":false,"displayName":"id","defaultMatch":true},{"id":"Title","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"Title","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Image","type":"array","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"Image","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Description","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"Description","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Model","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"Model","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Material","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"Material","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Color","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"Color","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Condition","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"Condition","defaultMatch":false,"canBeUsedToMatch":true},{"id":"AI_status","type":"boolean","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"AI_status","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["id"]},"options":{}},"id":"f60d8811-3cad-43e3-bbca-59843590cf04","name":"Enrich Product Rows","type":"n8n-nodes-base.airtable","position":[760,300],"typeVersion":2},{"parameters":{"content":"## Try It Out!\n### This workflow does the following:\n* Scans an Airtable spreadsheet for rows with product photo images.\n* Uses an AI vision model to attempt to identify the product.\n* Uses an AI Agent to research the product on the internet to enrich the product data.\n* Overwrites our Airtable spreadsheet with the enriched data.\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\n\nHappy Hacking!","height":381.0536322713287,"width":359.6648027457353},"id":"dc614f76-e2b7-4ab5-82fd-cf2d1b41e359","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-1240,-20],"typeVersion":1},{"parameters":{"resource":"image","operation":"analyze","text":"=Focus on the {{ $json.Title }} in the image - we'll refer to this as the \"object\". Identify the following attributes of the object. If you cannot determine confidently, then leave blank and move to next attribute.\n* Decription of the object.\n* The model/make of the object.\n* The material(s) used in the construction of the object.\n* The color(s) of the object\n* The condition of the object. Use one of poor, good, excellent.\n","imageUrls":"={{ $json.Image[0].thumbnails.large.url }}","options":{}},"id":"ff37906e-d7c2-44c0-84c7-e7494267e7b3","name":"Analyse Image","type":"@n8n/n8n-nodes-langchain.openAi","position":[-300,320],"typeVersion":1.3},{"parameters":{"agent":"openAiFunctionsAgent","promptType":"define","text":"=system: Your role is to help an building surveyor perform a object classification and data collection task whereby the surveyor will take photos of various objects and your job is to try and identify accurately certain product attributes of the objects as detailed below.\n\nThe surveyor has given you the following:\n1) photo url ```{{ $('Get Applicable Rows').item.json.Image[0].thumbnails.large.url }}```.\n2) photo description ```{{ $json.content }}```.\n\nFor each product attribute the surveyor is unable to determine, you may:\n1) use the reverse image search tool to search the product on the internet via the provided image url.\n2) use the web scraper tool to read webpages on the internet which may be relevant to the product.\n3) If after using these tools, you are still unable to determine the required product attributes then leave the data blank.\n\nUse all the information provided and gathered, to extract the following product attributes: title, description, model, material, color and condition.","hasOutputParser":true,"options":{}},"id":"c90153a0-28b2-4d8c-9d59-36bea7f274ee","name":"Object Identifier Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[140,260],"typeVersion":1.5},{"parameters":{"rules":{"values":[{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.route }}","rightValue":"serp.google_reverse_image"}]},"renameOutput":true,"outputKey":"serp.google_reverse_image"},{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"0a1f54ae-39f1-468d-ba6e-1376d13e4ee8","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.route }}","rightValue":"firecrawl.scrape"}]},"renameOutput":true,"outputKey":"firecrawl.scrape"}]},"options":{"fallbackOutput":"extra"}},"id":"b7f1301c-f8c8-4517-81fc-55b44c463613","name":"Actions Router","type":"n8n-nodes-base.switch","position":[460,980],"typeVersion":3},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n🚨**Required**\n* Set Airtable Base and Table IDs here.","height":297.0159375852115,"width":181.2788838920522},"id":"392335fd-22bd-44fd-b493-4d3c912b560b","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[-580,340],"typeVersion":1},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n🚨**Required**\n* Set Airtable Base and Table IDs here.","height":297.0159375852115,"width":181.2788838920522},"id":"af2a88fd-9d81-415e-b34e-da3604fdc882","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[800,360],"typeVersion":1},{"parameters":{"content":"## 5.1 Google Reverse Image Tool\nThis tool uses Google's reverse image API to return websites where similar images are found.","height":298.81538450684064,"width":460.3301604548244,"color":7},"id":"e06dbdbc-0e29-4b32-929b-fc6834b81f04","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[660,680],"typeVersion":1},{"parameters":{"content":"## 5.2 Webscraper Tool\nThis tool uses Firecrawl.dev API to crawl webpages and returns those pages in markdown format.","height":463.34699288922565,"width":575.3216480295998,"color":7},"id":"1732d55a-6300-4cec-8fa4-6ed9608751fb","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[660,1020],"typeVersion":1}],"connections":{"Edit Fields":{"main":[[{"node":"Actions Router","type":"main","index":0}]]},"Analyse Image":{"main":[[{"node":"Object Identifier Agent","type":"main","index":0}]]},"Actions Router":{"main":[[{"node":"SERP Google Reverse Image API","type":"main","index":0}],[{"node":"Firecrawl Scrape API","type":"main","index":0}],[{"node":"Fallback Response","type":"main","index":0}]]},"Scrape Success?":{"main":[[{"node":"Firecrawl Scrape Success Response","type":"main","index":0}],[{"node":"Firecrawl scrape Error Response","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Object Identifier Agent","type":"ai_languageModel","index":0}]]},"Get Applicable Rows":{"main":[[{"node":"Analyse Image","type":"main","index":0}]]},"Firecrawl Scrape API":{"main":[[{"node":"Scrape Success?","type":"main","index":0}]]},"Object Identifier Agent":{"main":[[{"node":"Enrich Product Rows","type":"main","index":0}]]},"Execute Workflow Trigger":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Object Identifier Agent","type":"ai_outputParser","index":0}]]},"Firecrawl Web Scaper Tool":{"ai_tool":[[{"node":"Object Identifier Agent","type":"ai_tool","index":0}]]},"Reverse Image Search Tool":{"ai_tool":[[{"node":"Object Identifier Agent","type":"ai_tool","index":0}]]},"SERP Google Reverse Image API":{"main":[[{"node":"Reverse Image Search Response","type":"main","index":0}]]},"When clicking \"Test workflow\"":{"main":[[{"node":"Get Applicable Rows","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"e741cdcb-6a84-4bce-b8a4-9c1c4c6c3326","triggerCount":0,"tags":[{"createdAt":"2025-02-11T23:59:41.483Z","updatedAt":"2025-02-14T16:18:26.979Z","id":"dzhL8PxGOvRSKz2J","name":"ANCORA IN TEST"},{"createdAt":"2025-02-12T01:27:20.078Z","updatedAt":"2025-02-12T01:27:20.078Z","id":"wKG1EEc4KjZp5Caj","name":"IMAGE"}]}