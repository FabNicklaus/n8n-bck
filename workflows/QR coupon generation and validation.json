{"createdAt":"2025-02-14T16:22:52.976Z","updatedAt":"2025-02-14T16:22:57.000Z","id":"cUy2uUhtojrVkFlz","name":"QR coupon generation and validation","active":false,"nodes":[{"parameters":{"path":"bb832325-8c58-4717-b866-41f8a9714cf2","responseMode":"responseNode","options":{}},"id":"8a893828-772b-4e07-8fed-b5418752602e","name":"Webhook","type":"n8n-nodes-base.webhook","position":[60,1240],"webhookId":"bb832325-8c58-4717-b866-41f8a9714cf2","typeVersion":2},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"430aee2d-a788-4d7c-ab64-880c900f0058","operator":{"type":"string","operation":"exists","singleValue":true},"leftValue":"={{ $json.qr }}","rightValue":""}]},"options":{}},"id":"a6bf4cb3-4581-4069-a91c-1a4446a71cf9","name":"If","type":"n8n-nodes-base.if","position":[520,1240],"typeVersion":2.2},{"parameters":{"requestMethod":"POST","url":"=https://SUITECRMURL/Api/access_token","allowUnauthorizedCerts":true,"options":{},"bodyParametersUi":{"parameter":[{"name":"grant_type","value":"client_credentials"},{"name":"client_id","value":"CLIENTID"},{"name":"client_secret","value":"CLIENTSECRET"}]}},"id":"1cd43660-1ef2-4ca6-a021-a58f0b813537","name":"Token SuiteCRM","type":"n8n-nodes-base.httpRequest","position":[1180,580],"notesInFlow":true,"typeVersion":1},{"parameters":{"method":"POST","url":"https://SUITECRMURL/Api/V8/module","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{$node[\"Token SuiteCRM\"].json[\"access_token\"]}}"},{"name":"Content-Type","value":"application/vnd.api+json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\"data\": \n  {\n  \"type\": \"Leads\",\n  \"attributes\": { \n  \"first_name\": \"{{ $('Form Fields').item.json.Name }}\",\n  \"last_name\": \"{{ $('Form Fields').item.json.Surname }}\",\n  \"email1\": \"{{ $('Form Fields').item.json.Email }}\",\n  \"phone_mobile\":\"{{ $('Form Fields').item.json.Phone }}\",\n  \"coupon_c\": \"{{ $('Get Coupon').item.json.COUPON }}\"\n  }\n  }\n}","options":{"response":{"response":{"responseFormat":"json"}}}},"id":"6afb573c-af60-4ad3-8ee2-86afd76ad0c0","name":"Create Lead SuiteCRM","type":"n8n-nodes-base.httpRequest","position":[1420,580],"notesInFlow":true,"typeVersion":3},{"parameters":{"formTitle":"Landing","formFields":{"values":[{"fieldLabel":"Name","placeholder":"Name","requiredField":true},{"fieldLabel":"Surname","placeholder":"Surname","requiredField":true},{"fieldLabel":"Email","fieldType":"email","placeholder":"Email","requiredField":true},{"fieldLabel":"Phone","placeholder":"Phone","requiredField":true}]},"options":{}},"id":"3e3b7972-742f-4ab9-afda-bb046641d750","name":"On form submission","type":"n8n-nodes-base.formTrigger","position":[60,480],"webhookId":"63d1d84b-c41e-4d3d-961a-0aa2af830ceb","typeVersion":2.2},{"parameters":{"documentId":{"__rl":true,"mode":"list","value":"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk","cachedResultName":"Coupon"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0","cachedResultName":"Foglio1"},"filtersUI":{"values":[{"lookupColumn":"EMAIL","lookupValue":"={{ $json.Email }}"}]},"options":{}},"id":"b07a7c92-449c-4bbe-82bb-cf2002227a83","name":"Duplicate Lead?","type":"n8n-nodes-base.googleSheets","position":[500,480],"typeVersion":4.5,"alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"661d1475-f964-4a12-bfe7-88bf96851319","name":"Name","type":"string","value":"={{ $json.Name }}"},{"id":"9991645d-c716-47db-80d6-850f3d64c782","name":"Surname","type":"string","value":"={{ $json.Surname }}"},{"id":"c999afa6-2ec7-4f7f-bf3b-088a3597591c","name":"Email","type":"string","value":"={{ $json.Email }}"},{"id":"f3faccdb-2412-4363-a0e3-f13b8f85b242","name":"Phone","type":"string","value":"={{ $json.Phone }}"}]},"options":{}},"id":"f9fde5ec-376e-459e-af10-1bd981c73baf","name":"Form Fields","type":"n8n-nodes-base.set","position":[300,480],"typeVersion":3.4},{"parameters":{"documentId":{"__rl":true,"mode":"list","value":"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk","cachedResultName":"Coupon"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0","cachedResultName":"Foglio1"},"filtersUI":{"values":[{"lookupColumn":"ID LEAD"}]},"options":{"returnFirstMatch":true}},"id":"e9d2db89-582a-4160-bf60-dc848e3f2b8d","name":"Get Coupon","type":"n8n-nodes-base.googleSheets","position":[960,580],"executeOnce":false,"typeVersion":4.5},{"parameters":{"operation":"update","documentId":{"__rl":true,"mode":"list","value":"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk","cachedResultName":"Coupon"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0","cachedResultName":"Foglio1"},"columns":{"value":{"DATE":"={{ $now.format('dd/LL/yyyy HH:mm:ss') }}","NAME":"={{ $json.data.attributes.first_name }}","EMAIL":"={{ $json.data.attributes.email1 }}","PHONE":"={{ $json.data.attributes.phone_mobile }}","COUPON":"={{ $('Get Coupon').item.json.COUPON }}","ID LEAD":"={{ $json.data.id }}","SURNAME":"={{ $json.data.attributes.last_name }}"},"schema":[{"id":"NAME","type":"string","display":true,"required":false,"displayName":"NAME","defaultMatch":false,"canBeUsedToMatch":true},{"id":"SURNAME","type":"string","display":true,"required":false,"displayName":"SURNAME","defaultMatch":false,"canBeUsedToMatch":true},{"id":"EMAIL","type":"string","display":true,"required":false,"displayName":"EMAIL","defaultMatch":false,"canBeUsedToMatch":true},{"id":"PHONE","type":"string","display":true,"required":false,"displayName":"PHONE","defaultMatch":false,"canBeUsedToMatch":true},{"id":"COUPON","type":"string","display":true,"removed":false,"required":false,"displayName":"COUPON","defaultMatch":false,"canBeUsedToMatch":true},{"id":"DATE","type":"string","display":true,"required":false,"displayName":"DATE","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ID LEAD","type":"string","display":true,"required":false,"displayName":"ID LEAD","defaultMatch":false,"canBeUsedToMatch":true},{"id":"row_number","type":"string","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"row_number","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["COUPON"],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"420ee26b-caf5-4459-a1e6-486364b0cfd8","name":"Update Sheet","type":"n8n-nodes-base.googleSheets","position":[1660,580],"typeVersion":4.5},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"9e3a8422-14f1-453e-bfed-4feecff34662","operator":{"type":"string","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.EMAIL }}","rightValue":"={{ $('Form Fields').item.json.email }}"}]},"options":{}},"id":"c7cefa93-840a-4c2d-9c94-6bfc6c1f8c3d","name":"Is Duplicate?","type":"n8n-nodes-base.if","position":[700,480],"typeVersion":2.2},{"parameters":{"content":"Check if the lead has already received the coupon","height":240,"width":340},"id":"59442bb7-64f2-4c5a-8041-ba8c6a2ff7c5","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[280,400],"typeVersion":1},{"parameters":{"content":"Find the first available unassigned coupon","height":220,"width":180},"id":"27626fda-4e19-4b8f-b1b5-a0f8bb6e19e4","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[920,520],"typeVersion":1},{"parameters":{"content":"Enter the lead with the relative coupon on Suite CRM. Change SUITECRMURL, CLIENTSECRET and CLIENTID","height":220,"width":400},"id":"f480edfd-bd4e-42e1-86c2-8c6287f0aefd","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[1160,520],"typeVersion":1},{"parameters":{"url":"=https://quickchart.io/qr?text=https://n8n.n3witalia.com/webhook-test/bb832325-8c58-4717-b866-41f8a9714cf2?qr={{ $('Get Coupon').item.json.COUPON }}&size=250","options":{}},"id":"8611adc5-6d6e-406b-8560-61ff02604db8","name":"Get QR","type":"n8n-nodes-base.httpRequest","position":[1880,580],"typeVersion":4.2},{"parameters":{"fromEmail":"=EMAILFROM","toEmail":"={{ $('Form Fields').item.json.Email }}","subject":"[n8n] Exclusive Discount Coupon","html":"=<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Exclusive Discount Coupon</title>\n</head>\n<body style=\"font-family: Arial, sans-serif; text-align: center;\">\n    <h2>Get Your Exclusive Discount!</h2>\n    <p>Hi {{ $('On form submission').item.json.Name }},<br>\n    Scan the QR code below to claim your special discount.</p>\n    \n    <img src=\"https://quickchart.io/qr?text=https://n8n.n3witalia.com/webhook-test/bb832325-8c58-4717-b866-41f8a9714cf2?qr={{ $('Get Coupon').item.json.COUPON }}&size=250\" alt=\"Scan to get your discount\" style=\"margin: 20px;\">\n    \n    <p>Hurry, the offer is limited!</p>\n</body>\n</html>\n","options":{}},"id":"06d9e1fa-768e-4284-b106-cc027d1807d0","name":"Send Email","type":"n8n-nodes-base.emailSend","position":[2100,580],"webhookId":"a84b051c-7d5f-4c17-bac6-68a9df9fa7c7","typeVersion":2.1},{"parameters":{"method":"PATCH","url":"=https://suitecrm.dev.n3witalia.com/Api/V8/module","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{$node[\"Token SuiteCRM 1\"].json[\"access_token\"]}}"},{"name":"Content-Type","value":"application/vnd.api+json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"data\": {\n    \"type\": \"Leads\",\n    \"id\": \"{{ $('Not used?').item.json['ID LEAD'] }}\",\n    \"attributes\": {\n      \"coupon_used_c\": \"yes\"\n    }\n  }\n}","options":{"response":{"response":{"responseFormat":"json"}}}},"id":"a0bc91ca-4ae5-4ffe-a2f6-f13903bc1d0e","name":"Update Lead","type":"n8n-nodes-base.httpRequest","position":[1500,1000],"notesInFlow":true,"typeVersion":3},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"50546d87-ab37-4c8a-b835-e1a60f3aa0dc","operator":{"type":"string","operation":"empty","singleValue":true},"leftValue":"={{ $json['USED COUPON?'] }}","rightValue":""},{"id":"025a42b8-fb90-44a8-951a-0e321b42c3b9","operator":{"type":"number","operation":"exists","singleValue":true},"leftValue":"={{ $json.row_number }}","rightValue":""}]},"options":{}},"id":"92d6b1ef-1429-4e06-baa4-0b6a12221565","name":"Not used?","type":"n8n-nodes-base.if","position":[1020,1140],"typeVersion":2.2},{"parameters":{"respondWith":"text","responseBody":"Qr valid!","options":{}},"id":"e3c0fba0-5e2e-478e-92f7-6a7308ccd340","name":"Coupon OK","type":"n8n-nodes-base.respondToWebhook","position":[1960,1000],"typeVersion":1.1},{"parameters":{"respondWith":"text","responseBody":"Coupon not valid","options":{"responseCode":200}},"id":"6f0e4034-a01f-43b4-9ab9-69dcc73ac253","name":"No coupon","type":"n8n-nodes-base.respondToWebhook","position":[800,1360],"typeVersion":1.1},{"parameters":{"respondWith":"text","responseBody":"Coupon already used","options":{"responseCode":200}},"id":"fe64bfdc-29fa-495d-8f71-a244f8fabda8","name":"Coupon KO","type":"n8n-nodes-base.respondToWebhook","position":[1280,1220],"typeVersion":1.1},{"parameters":{"requestMethod":"POST","url":"=https://SUITECRMURL/Api/access_token","allowUnauthorizedCerts":true,"options":{},"bodyParametersUi":{"parameter":[{"name":"grant_type","value":"client_credentials"},{"name":"client_id","value":"CLIENTID"},{"name":"client_secret","value":"CLIENTSECRET"}]}},"id":"729b38e2-81ae-48e2-b687-f5d12a804556","name":"Token SuiteCRM 1","type":"n8n-nodes-base.httpRequest","position":[1280,1000],"notesInFlow":true,"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"4e9a4330-d654-410f-9b99-aa57545c2c80","name":"qr","type":"string","value":"={{ $json.query.qr }}"}]},"options":{}},"id":"2e113f1e-05dd-4bb9-accd-dcf7c162314d","name":"Set coupon","type":"n8n-nodes-base.set","position":[300,1240],"typeVersion":3.4},{"parameters":{"documentId":{"__rl":true,"mode":"list","value":"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk","cachedResultName":"Coupon"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0","cachedResultName":"Foglio1"},"filtersUI":{"values":[{"lookupColumn":"COUPON","lookupValue":"={{ $json.qr }}"}]},"options":{"returnFirstMatch":true}},"id":"6cbf60d5-d7ca-4cb4-bd23-fdaf3885e742","name":"Get Lead","type":"n8n-nodes-base.googleSheets","position":[800,1140],"typeVersion":4.5},{"parameters":{"content":"Check if the QR code scan is valid","height":220,"width":360},"id":"455b90a1-a78d-4df0-a139-9be3da7986a6","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[280,1180],"typeVersion":1},{"parameters":{"content":"Check if coupon is valid","height":220,"width":360},"id":"7b8e7b42-1c95-4ffc-9e9c-fe8f44c87616","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[780,1080],"typeVersion":1},{"parameters":{"content":"Enter the lead with the relative coupon on Suite CRM. Change SUITECRMURL, CLIENTSECRET and CLIENTID","height":220,"width":420},"id":"48c1a10c-5b97-4498-9fc5-ce575ef682b8","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[1240,940],"typeVersion":1},{"parameters":{"operation":"update","documentId":{"__rl":true,"mode":"list","value":"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk","cachedResultName":"Coupon"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0","cachedResultName":"Foglio1"},"columns":{"value":{"ID LEAD":"={{ $json.data.id }}","USED COUPON?":"yes"},"schema":[{"id":"NAME","type":"string","display":true,"required":false,"displayName":"NAME","defaultMatch":false,"canBeUsedToMatch":true},{"id":"SURNAME","type":"string","display":true,"required":false,"displayName":"SURNAME","defaultMatch":false,"canBeUsedToMatch":true},{"id":"EMAIL","type":"string","display":true,"required":false,"displayName":"EMAIL","defaultMatch":false,"canBeUsedToMatch":true},{"id":"PHONE","type":"string","display":true,"required":false,"displayName":"PHONE","defaultMatch":false,"canBeUsedToMatch":true},{"id":"COUPON","type":"string","display":true,"required":false,"displayName":"COUPON","defaultMatch":false,"canBeUsedToMatch":true},{"id":"DATE","type":"string","display":true,"required":false,"displayName":"DATE","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ID LEAD","type":"string","display":true,"removed":false,"required":false,"displayName":"ID LEAD","defaultMatch":false,"canBeUsedToMatch":true},{"id":"USED COUPON?","type":"string","display":true,"required":false,"displayName":"USED COUPON?","defaultMatch":false,"canBeUsedToMatch":true},{"id":"row_number","type":"string","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"row_number","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["ID LEAD"],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"7240c1a5-7499-4de4-9c73-ecf88312c52f","name":"Update coupon used","type":"n8n-nodes-base.googleSheets","position":[1720,1000],"typeVersion":4.5},{"parameters":{"content":"Set the Webhook URL","height":220,"width":220},"id":"7ebfd794-1256-470c-b7ff-76f333adad2a","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[2040,520],"typeVersion":1},{"parameters":{"content":"## Coupon assignment and simple validation system\n\nThis workflow is designed to manage the assignment and validation of unique QR code coupons within a lead generation system. The process begins with a webhook that receives data from a user-filled form, containing information such as name, surname, email, and phone number. This data is then processed to check if the lead already exists in the system, preventing duplicates.\n\nDISCLAIMER: The system is very simple and basic but can be improved and made very efficient through specific controls and new implementations","height":240,"width":680,"color":3},"id":"b43089b4-a2c5-4d4f-8426-6ab650cc2fd8","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1}],"connections":{"If":{"main":[[{"node":"Get Lead","type":"main","index":0}],[{"node":"No coupon","type":"main","index":0}]]},"Get QR":{"main":[[{"node":"Send Email","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Set coupon","type":"main","index":0}]]},"Get Lead":{"main":[[{"node":"Not used?","type":"main","index":0}]]},"Not used?":{"main":[[{"node":"Token SuiteCRM 1","type":"main","index":0}],[{"node":"Coupon KO","type":"main","index":0}]]},"Get Coupon":{"main":[[{"node":"Token SuiteCRM","type":"main","index":0}]]},"Set coupon":{"main":[[{"node":"If","type":"main","index":0}]]},"Form Fields":{"main":[[{"node":"Duplicate Lead?","type":"main","index":0}]]},"Update Lead":{"main":[[{"node":"Update coupon used","type":"main","index":0}]]},"Update Sheet":{"main":[[{"node":"Get QR","type":"main","index":0}]]},"Is Duplicate?":{"main":[[],[{"node":"Get Coupon","type":"main","index":0}]]},"Token SuiteCRM":{"main":[[{"node":"Create Lead SuiteCRM","type":"main","index":0}]]},"Duplicate Lead?":{"main":[[{"node":"Is Duplicate?","type":"main","index":0}]]},"Token SuiteCRM 1":{"main":[[{"node":"Update Lead","type":"main","index":0}]]},"On form submission":{"main":[[{"node":"Form Fields","type":"main","index":0}]]},"Update coupon used":{"main":[[{"node":"Coupon OK","type":"main","index":0}]]},"Create Lead SuiteCRM":{"main":[[{"node":"Update Sheet","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"b3b88747-d3d6-4b94-8077-a1ce86ad5e4d","triggerCount":0,"tags":[{"createdAt":"2025-02-11T23:59:41.483Z","updatedAt":"2025-02-14T16:18:26.979Z","id":"dzhL8PxGOvRSKz2J","name":"ANCORA IN TEST"}]}