{"createdAt":"2025-02-28T16:07:31.948Z","updatedAt":"2025-02-28T16:18:58.000Z","id":"HbIHcKV2w2x5W9R6","name":"esperimento A","active":false,"nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[-420,120],"id":"3f675709-601e-4a2a-8421-92f49e21c52d","name":"Telegram Trigger","webhookId":"c6698209-216d-40e7-a166-3e953cdfb8ca","credentials":{"telegramApi":{"id":"c9eLhTj5KHfRBavw","name":"Telegram account"}}},{"parameters":{"promptType":"define","text":"={{ $('Switch').item.json.message.text }}","options":{"systemMessage":"=# Role\nYou are a helpful assistant called Rafaels Assistant.\nYou are talking to {{ $('Switch').item.json.message.from.first_name }}.\n\n# Additional Context\nCurrent date and time: {{ $now }}.\nDo not output responses in <think>.\nDo NOT output responses regarding writing emails, without first passing them to Email_Writer.\n\n# Tools Overview\nYou have access to the following tools.\n\n## Calculator\nUse this tool to perform any math calculations\n\n## ResearchAgent\nUse this tool to perform research on any given topic. Pass a detailed query to this tool in order to perform the best possible research.\n\n## Email_Writer\nUse this tool to draft emails when being asked, or to send out requests to companies you collected with the ResearchAgent tool when asked.\nAlways output answers in this format:\n\n-Recepients email\n-Subject line\n-Body\n\nAlways use the EmailAgent tool when asked to write or draft emails."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[360,120],"id":"2bfd5e1b-02ff-42a8-988b-1b9ab25a9fa9","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"=","mode":"id"},"options":{"responseFormat":"text"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-380,380],"id":"47e7862d-22ce-4f6a-94a4-bd33df45b4d4","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"KGWrubCDJoZ8doQM","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.from.id }}","contextWindowLength":20},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[220,440],"id":"01004224-a592-4fa8-beb0-80fbd834f909","name":"Window Buffer Memory"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[480,500],"id":"d553cdf2-574b-44fa-b9de-581d72f25d4f","name":"Calculator"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[720,120],"id":"476a6635-dac5-4848-a8a2-78d6855e9a1c","name":"Response","webhookId":"8b550c24-7c98-4552-ac8f-7554bffd6da6","credentials":{"telegramApi":{"id":"c9eLhTj5KHfRBavw","name":"Telegram account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fab397a9-fd84-47e5-ae70-2eef44a06802","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-220,120],"id":"593c49d7-cbc3-4835-a8e2-c7664e35c5ae","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"416f7b8b-a6ce-4e23-9b64-01e943f1d896","name":"text","value":"={{ $json.message.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,140],"id":"edfca0a6-2e9e-46d9-b177-75a790088717","name":"Set Text"},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}"},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[0,0],"id":"493725fa-b2ae-4231-bc8d-887d7693025c","name":"Download Voice File","webhookId":"61331eda-be8b-4c79-abc3-d1fbee8482c4","credentials":{"telegramApi":{"id":"c9eLhTj5KHfRBavw","name":"Telegram account"}}},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[200,0],"id":"274d5956-a489-4bde-91d1-ecf755409084","name":"OpenAI","credentials":{"openAiApi":{"id":"KGWrubCDJoZ8doQM","name":"OpenAi account"}}},{"parameters":{"name":"email_writer","description":"Call this tool to write and draft emails.","workflowId":{"__rl":true,"value":"Z869OFxuyUrNffyX","mode":"list","cachedResultName":"My workflow 2"},"workflowInputs":{"mappingMode":"defineBelow","value":{"output":"={{ $('AI Agent').first().json.output }}"},"matchingColumns":["output"],"schema":[{"id":"output","displayName":"output","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[420,340],"id":"4cbd6fee-c469-42c4-9e96-33b3486fdf87","name":"Research Agent"},{"parameters":{"name":"ResearchAgent","description":"Call this tool to do research when asked to.","workflowId":{"__rl":true,"value":"HotiYlpqVVl4S9e9","mode":"list","cachedResultName":"Email Agent"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ $('AI Agent').first().json.output }}"},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[600,360],"id":"4f773905-7422-4a22-a366-ee251875cc49","name":"Email Agent"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.2,"position":[40,360],"id":"fbbabf51-34b6-4248-89f2-e45e7eaa35ff","name":"Anthropic Chat Model","credentials":{"anthropicApi":{"id":"W1JQI46DxY1zWg5g","name":"Anthropic account"}}}],"connections":{"Telegram Trigger":{"main":[[{"node":"Switch","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Response","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[]]},"Window Buffer Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Calculator":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Switch":{"main":[[{"node":"Download Voice File","type":"main","index":0}],[{"node":"Set Text","type":"main","index":0}]]},"Set Text":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Download Voice File":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Research Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Email Agent":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Anthropic Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"38817695-2836-40ce-ac1a-d163166c6d77","triggerCount":0,"tags":[]}