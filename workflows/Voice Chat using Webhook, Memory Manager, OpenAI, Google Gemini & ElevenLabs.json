{"createdAt":"2025-02-17T22:59:57.028Z","updatedAt":"2025-02-17T23:00:17.000Z","id":"t5hr5l7CdLIa0W2X","name":"Voice Chat using Webhook, Memory Manager, OpenAI, Google Gemini & ElevenLabs","active":false,"nodes":[{"parameters":{"options":{}},"id":"7fcbcfba-fdd6-43a5-8598-5b1a0e0b1d1d","name":"Get Chat","type":"@n8n/n8n-nodes-langchain.memoryManager","position":[-300,360],"typeVersion":1,"alwaysOutputData":true},{"parameters":{"mode":"insert","messages":{"messageValues":[{"type":"user","message":"={{ $('OpenAI - Speech to Text').item.json[\"text\"] }}"},{"type":"ai","message":"={{ $json.text }}"}]}},"id":"9d8f0c3b-ae7e-4663-a4b5-eec108331e4b","name":"Insert Chat","type":"@n8n/n8n-nodes-langchain.memoryManager","position":[540,360],"typeVersion":1,"alwaysOutputData":true},{"parameters":{"content":"## Get Context","height":238.4911357933579,"width":486.4746124819703,"color":6},"id":"90f91ac8-2b4c-415f-8e6f-0821aeb97e90","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[-340,280],"typeVersion":1},{"parameters":{"content":"## Save Context","height":231.05945912581728,"width":321.2536584847704,"color":6},"id":"779de3d8-a761-4d19-b2a8-4e03ed89631c","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[520,280],"typeVersion":1},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"context","options":{}},"id":"59966d3a-047c-4352-a2e0-764e37b93e39","name":"Aggregate","type":"n8n-nodes-base.aggregate","position":[20,360],"typeVersion":1,"alwaysOutputData":true},{"parameters":{"sessionIdType":"customKey","sessionKey":"test-0dacb3b5-4bcd-47dd-8456-dcfd8c258204"},"id":"27f9d85f-24b5-4ff4-a44e-b087ca4e8421","name":"Window Buffer Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[80,660],"typeVersion":1.2},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"id":"d3c30dca-c3ef-4297-95e4-cc2486b41407","name":"Google Gemini Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","position":[220,660],"typeVersion":1},{"parameters":{"respondWith":"binary","options":{}},"id":"41547163-c078-46b7-95c6-d8f7650b0435","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","position":[1560,360],"typeVersion":1.1},{"parameters":{"method":"POST","url":"=https://api.elevenlabs.io/v1/text-to-speech/{{voice id}}","authentication":"genericCredentialType","genericAuthType":"httpCustomAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"text","value":"={{ $('Basic LLM Chain').item.json.text }}"}]},"options":{}},"id":"3be6a832-0e83-4d3e-b26c-d8727ba73860","name":"ElevenLabs - Generate Audio","type":"n8n-nodes-base.httpRequest","position":[1240,360],"typeVersion":4.2},{"parameters":{"content":"* ### For the Text-to-Speech part, we'll use ElevenLabs.io, which is free and offers a variety of voices to choose from. However, you can also use the OpenAI `\"Generate audio\"` node instead.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n* ### Since there is no pre-built node for `\"ElevenLabs\"` in n8n, we'll connect to it through its API using the \"HTTP Request\" node.\n\n## Prerequisites:\n* ### `\"ElevenLabs API Key\"` (you can obtain it from their website).\n* ### `\"Voice ID\"` (you can also get it from ElevenLabs' \"Voice Library\").\n## Setup\n* ### In the URL parameter, replace \"{{voice id}}\" at the end of the URL with the Voice ID you obtained from ElevenLabs.io.\n* ### To set up your API Key, add custom authentication and include the following `JSON` with your acual ElevenLabs API Key:\n```json\n{\n  \"headers\": {\n    \"xi-api-key\": \"put-your-API-Key-here\"\n  }\n}\n```","height":843.7602354099661,"width":468.73250812192407},"id":"d2552812-bb68-4202-83ce-14277c8e0743","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[1040,200],"typeVersion":1},{"parameters":{"content":"### The \"Get Chat,\" \"Insert Chat,\" and \"Window Buffer Memory\" nodes will help the LLM model maintain context throughout the conversation.","height":91.01435855269375,"width":487.4293487597613,"color":6},"id":"abc33119-f970-4410-87cc-66643db28409","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-340,160],"typeVersion":1},{"parameters":{},"id":"f3ec817a-e012-4b82-bab5-1b616e7d3411","name":"Limit","type":"n8n-nodes-base.limit","position":[900,360],"typeVersion":1},{"parameters":{"promptType":"define","text":"={{ $('OpenAI - Speech to Text').item.json[\"text\"] }}","messages":{"messageValues":[{"type":"AIMessagePromptTemplate","message":"=To maintain context and fully understand the user's question, always review the previous conversation between you and him before providing an answer.\nThis is the previous conversation:\n{{ $('Aggregate').item.json[\"context\"].map(m => `\nHuman: ${m.human || 'undefined'}\nAI Assistant: ${m.ai || 'undefined'}\n`).join('') }}"}]}},"id":"0bfdcc2a-4b10-473f-9109-25754f891efa","name":"Basic LLM Chain","type":"@n8n/n8n-nodes-langchain.chainLlm","position":[200,360],"typeVersion":1.4},{"parameters":{"httpMethod":"POST","path":"voice_message","responseMode":"responseNode","options":{}},"id":"4df39d99-9e3a-4e65-836f-0d87c3ca4bee","name":"Webhook","type":"n8n-nodes-base.webhook","position":[-680,360],"webhookId":"e9f611eb-a8dd-4520-8d24-9f36deaca528","typeVersion":2},{"parameters":{"resource":"audio","operation":"transcribe","binaryPropertyName":"voice_message","options":{}},"id":"42bd23fb-fd1e-4bf1-b0fc-fbf1f560a301","name":"OpenAI - Speech to Text","type":"@n8n/n8n-nodes-langchain.openAi","position":[-500,360],"typeVersion":1.3}],"connections":{"Limit":{"main":[[{"node":"ElevenLabs - Generate Audio","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"OpenAI - Speech to Text","type":"main","index":0}]]},"Get Chat":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]},"Insert Chat":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Insert Chat","type":"main","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"Insert Chat","type":"ai_memory","index":0},{"node":"Get Chat","type":"ai_memory","index":0}]]},"OpenAI - Speech to Text":{"main":[[{"node":"Get Chat","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"ElevenLabs - Generate Audio":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"7a3f2131-3591-44b3-b17a-a5d00a1501da","triggerCount":0,"tags":[{"createdAt":"2025-02-12T01:25:44.824Z","updatedAt":"2025-02-12T01:25:44.824Z","id":"bzJZk40lpXglcXDs","name":"CHAT"},{"createdAt":"2025-02-11T23:59:41.483Z","updatedAt":"2025-02-14T16:18:26.979Z","id":"dzhL8PxGOvRSKz2J","name":"ANCORA IN TEST"},{"createdAt":"2025-02-10T13:32:48.613Z","updatedAt":"2025-02-23T19:53:15.863Z","id":"k5fZTQAhTgrJYO8g","name":"AD USO DEMO"}]}