{"createdAt":"2025-02-12T01:01:15.408Z","updatedAt":"2025-02-12T01:28:23.000Z","id":"HbrO603nsz4yYVsm","name":"Organise an Event using Slack, Google Calendar and AI","active":false,"nodes":[{"parameters":{"fieldToSplitOut":"users","options":{}},"id":"edc977d3-144f-4d1d-ada0-2aa6aea95d76","name":"For Each User ID...","type":"n8n-nodes-base.splitOut","position":[540,1200],"typeVersion":1},{"parameters":{"resource":"user","user":{"__rl":true,"mode":"id","value":"={{ $json.users }}"}},"id":"18fa6ec2-3493-41e1-9e35-29ebfeb6b15d","name":"Get User","type":"n8n-nodes-base.slack","position":[800,1040],"typeVersion":2.2,"webhookId":"521ca332-f09f-4cb1-9ca7-65bb1d874be0"},{"parameters":{"operation":"search","query":"in:#n8n-events has::calendar:","limit":3,"options":{}},"id":"6b579a84-baaf-42aa-8139-6c55880c5158","name":"Search for Invite Requests","type":"n8n-nodes-base.slack","position":[-760,600],"typeVersion":2.2,"webhookId":"706a88e4-7d42-4036-b8ce-19138a139450"},{"parameters":{"jsCode":"const channel =  $('Search for Invite Requests').item.json.channel;\n\nreturn $input\n  .all()\n  .filter(item => !item.json.thread_ts || item.json.ts === item.json.thread_ts)\n  .map(invite => {\n    const replies = $input\n      .all()\n      .filter(reply => reply.json.thread_ts === invite.json.thread_ts);\n    const replyWithEventTag = replies\n      .find(reply => reply.json.bot_id && reply.json.text.match(/#event([a-z0-9]+)/i));\n    const eventId = replyWithEventTag\n      ? replyWithEventTag.json.text.match(/#event([a-z0-9]+)/i)[1]\n      : null;\n    return {\n      eventId,\n      invite,\n      channel,\n    }\n  });\n\nreturn output;"},"id":"7cc47174-a94a-4073-b36d-c2958fe13afe","name":"Get Existing Invite EventID","type":"n8n-nodes-base.code","position":[-280,660],"typeVersion":2,"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"5c45447a-ab61-42c8-92c9-4c5d6970def7","operator":{"type":"string","operation":"notExists","singleValue":true},"leftValue":"={{ $json.eventId }}","rightValue":""}]},"options":{}},"id":"c5ab0fb7-cad6-4c45-b374-93042717e4bc","name":"Should Create Event?","type":"n8n-nodes-base.if","position":[-100,660],"typeVersion":2,"alwaysOutputData":false},{"parameters":{"calendar":{"__rl":true,"mode":"list","value":"c_5792bdf04bc395cbcbc6f7b754268245a33779d36640cc80a357711aa2f09a0a@group.calendar.google.com","cachedResultName":"n8n-events"},"start":"={{ $json.output.output.event_start_date }} {{ $json.output.output.event_start_time }}","end":"={{ $json.output.output.event_end_date ? $json.output.output.event_end_date + ' ' + $json.output.output.event_end_time : (new Date($json.output.output.event_start_date + ' ' + $json.output.output.event_start_time)).plus(3, 'hour').format('yyyy-MM-dd HH:mm:ss') }}","additionalFields":{"description":"=## {{ $json.output.output.event_title }}\n\n{{ $('Should Create Event?').item.json.invite.json.text }}\n\nTime:\n{{ $json[\"output\"][\"output\"][\"event_start_date\"] + ' ' + $json[\"output\"][\"output\"][\"event_start_time\"] }}{{ $json[\"output\"][\"output\"][\"event_end_date\"] ? ' to ' : '' }}{{ $json[\"output\"][\"output\"][\"event_end_date\"] ? \n $json[\"output\"][\"output\"][\"event_end_date\"] + ' ' + $json[\"output\"][\"output\"][\"event_end_time\"] : '' }}\n\nLocation:\n{{ $json[\"output\"][\"output\"][\"location_address\"] }}\n{{ $json[\"output\"][\"output\"][\"location_url\"] }}","guestsCanInviteOthers":true,"guestsCanModify":true,"guestsCanSeeOtherGuests":true,"location":"={{ $json.output.output.location_address }}","summary":"={{ $json.output.output.event_title }}"}},"id":"be9e5369-ed21-42db-91d2-2f88df33fd7e","name":"Create Event","type":"n8n-nodes-base.googleCalendar","position":[840,360],"typeVersion":1.1},{"parameters":{"resource":"reaction","operation":"get","channelId":{"__rl":true,"mode":"id","value":"={{ $('Should Create Event?').item.json.channel.id }}"},"timestamp":"={{ $('Should Create Event?').item.json.invite.json.ts }}"},"id":"e13bcb07-e995-4de9-9c17-8c5786b68e9d","name":"Get Invite Reactions","type":"n8n-nodes-base.slack","position":[540,1020],"typeVersion":2.2,"webhookId":"1a8a2e9d-a700-4b3e-ac29-4ca17c60431c"},{"parameters":{"resource":"channel","operation":"replies","channelId":{"__rl":true,"mode":"list","value":"C074W8X9UJV","cachedResultName":"n8n-events"},"ts":"={{ $json.ts }}","filters":{}},"id":"68bae3ee-e62e-4068-9d2f-6af888ff3398","name":"Get Invite Replies","type":"n8n-nodes-base.slack","position":[-460,660],"typeVersion":2.2,"alwaysOutputData":true,"webhookId":"a11cd506-ebe5-47af-9a4f-e96ee72f01f7"},{"parameters":{"fieldToSplitOut":"message.reactions","options":{}},"id":"06aeb5e9-c81e-4094-b4ae-06c55f108d9a","name":"Extract Invite Reactions","type":"n8n-nodes-base.splitOut","position":[220,1200],"typeVersion":1},{"parameters":{"mode":"raw","jsonOutput":"={\n  \"eventId\": \"{{ $json.eventId }}\",\n}","options":{}},"id":"b79fcf91-0305-4adb-ba52-d5a007e6a83b","name":"Get Old EventId","type":"n8n-nodes-base.set","position":[220,1020],"typeVersion":3.3,"alwaysOutputData":true},{"parameters":{"operation":"update","calendar":{"__rl":true,"mode":"list","value":"c_5792bdf04bc395cbcbc6f7b754268245a33779d36640cc80a357711aa2f09a0a@group.calendar.google.com","cachedResultName":"n8n-events"},"eventId":"={{ $('Get Old EventId').item.json.eventId }}","updateFields":{"attendees":["={{ $json.email }}"]}},"id":"9a54fe93-6e1b-4954-bf58-e7c6c528c6e5","name":"Add Attendee to Event","type":"n8n-nodes-base.googleCalendar","position":[1280,1040],"typeVersion":1.1},{"parameters":{"operation":"get","calendar":{"__rl":true,"mode":"list","value":"c_5792bdf04bc395cbcbc6f7b754268245a33779d36640cc80a357711aa2f09a0a@group.calendar.google.com","cachedResultName":"n8n-events"},"eventId":"={{ $json.eventId }}","options":{}},"id":"4bbadacb-d22e-4e51-9fad-177c36a0a6e4","name":"Get Event Details","type":"n8n-nodes-base.googleCalendar","position":[380,1020],"typeVersion":1.1},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"858b779e-732e-4b89-9007-93f9aafbb50b","operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.name }}","rightValue":"white_check_mark"}]},"options":{}},"id":"b42fd66d-409b-4c59-a017-66857562e18a","name":"Is Attending","type":"n8n-nodes-base.filter","position":[380,1200],"typeVersion":2},{"parameters":{"assignments":{"assignments":[{"id":"16978160-49ce-42d4-a4ed-677bb2bdfe8d","name":"email","type":"string","value":"={{ $json.profile.email }}"}]},"options":{}},"id":"c4d9fd48-2eb9-4dde-8e07-db813ed4ccb1","name":"Get User Email","type":"n8n-nodes-base.set","position":[1120,1040],"typeVersion":3.3},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"cb9590b0-2c0d-40e3-b379-cac9666d9ffe","operator":{"type":"boolean","operation":"false","singleValue":true},"leftValue":"={{ Boolean($('Get Event Details').item.json.attendees.find(x => x.email === $json.profile.email)) }}","rightValue":"false"}]},"options":{}},"id":"62b3a3bf-0e6d-472e-a4f6-e6ecadd2da61","name":"Should Add Attendee?","type":"n8n-nodes-base.if","position":[960,1040],"typeVersion":2},{"parameters":{"jsonSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"event_title\": { \"type\": \"string\" },\n    \"event_start_date\": { \"type\": \"string\" },\n    \"event_start_time\": { \"type\": \"string\" },\n    \"event_end_date\": { \"type\": \"string\" },\n    \"event_end_time\": { \"type\": \"string\" },\n    \"location_address\": { \"type\": \"string\" },\n    \"location_url\": { \"type\": \"string\" },\n    \"event_type\": { \"type\": \"string\" }\n  }\n}"},"id":"6f3e1669-0498-45a7-8222-772ca9b891a6","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","position":[520,440],"typeVersion":1.1},{"parameters":{"options":{}},"id":"0c02ce56-c7e8-4f27-96cf-dc345684670a","name":"SerpAPI","type":"@n8n/n8n-nodes-langchain.toolSerpApi","position":[340,500],"typeVersion":1},{"parameters":{"options":{}},"id":"96c2fbd2-90b1-40aa-b445-61e34b417c41","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[240,440],"typeVersion":1},{"parameters":{},"id":"1fa5b2f6-d1a4-4789-bd03-e1c0511e11f9","name":"Wikipedia","type":"@n8n/n8n-nodes-langchain.toolWikipedia","position":[460,540],"typeVersion":1},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":30}]}},"id":"2bfc6090-4839-4c47-80ab-8483854500b3","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","position":[-960,600],"typeVersion":1.2},{"parameters":{"content":"## 1. Pull Messages from Slack Channel\n[Read more about using the Slack](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.slack/)\n\nUsing the Slack Node, we're able to filter all top level messages marked with the calendar emoji signifying a request that a calendar event is created. Be sure to configure your slack app with all the required permissions for your workspace.","height":401.633728593893,"width":468.0872755624215,"color":7},"id":"0e385656-f2b2-4411-ab83-08151f7dffeb","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-1040,380],"typeVersion":1},{"parameters":{"content":"## 2. Decide Whether a new Event Should Be Created\n[Read more about using the Code](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.code)\n\nFor more complex workflows, sometimes you may need to gather and prepare variables before the rest of the workflow runs. The Code node is one such tool to achieve this if you're familiar with code but its not the only way.\n\nThis workflow splits based on whether the event needs to be created. When it already exists, attendees are updated for the existing event instead.","height":463.294565931203,"width":612.4609442091373,"color":7},"id":"8743e49e-719e-460b-813e-05f29ff4c0d7","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-540,420],"typeVersion":1},{"parameters":{"content":"## 3. Using AI Agent to Automate Event Creation\n[Read more about AI Agents](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent)\n\nAI Agents are generally described as self-governing LLMs with access to various \"tools\" which extend their knowledge and/or capability. In this demo, we've instructed the AI to do the following:\n1. Generate a nice Event title.\n2. Parse and assume dates and times from user message.\n3. Parse the address and website of location/venue and to use the \"tools\" if it cannot get this data from the message or its own knowledge.","height":614.2457232899785,"width":582.5773441997128,"color":7},"id":"a037e4e2-700b-4cd7-9dda-b0032c6d007c","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[120,40],"typeVersion":1},{"parameters":{"content":"## 5. Get Emoji Reactions to Track Attendees\n[Read more about using Slack](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.slack)\n\nWhen the event exists, we can instead start adding other team members who've reacted to the message with the ✅ emoji. In this part of the workflow, there's a bit of logic to compare the number of people who've reacted to the attendee list of the actual event. This is necessary to avoid unwanted notifications which could get quite annoying!","height":579.2571386002115,"width":555.022465659362,"color":7},"id":"ffad2712-cf2f-49ae-a04e-90c554459403","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[160,800],"typeVersion":1},{"parameters":{"content":"## 6. Add Attendees to Existing Calendar Event\n[Read more about using Google Calendar](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googlecalendar)\n\nn8n nodes make it easy to work with Google Calendar by having great converage on the Google API. Most common actions can be found in the dropdown list - there is no need to learn the code itself!\n","height":354.87325537783204,"width":665.8690262556933,"color":7},"id":"c1da0ed1-e85e-4c1a-9577-32c93ca2fb41","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[760,880],"typeVersion":1},{"parameters":{"content":"## Try It Out!\n### This workflow does the following\n* Monitors a slack channel for event messages tagged with the Calendar (📅) emoji.\n* Checks if a calender event exists otherwise uses ChatGPT to create the calendar event; AI will add event title, description and location details.\n* If calendar event exists, checks for channel users who have reacted with checkmark (✅) emoji.\n* These users are automatically added as attendees to the event.\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\n\nHappy Hacking!","height":416.9747281125149,"width":359.6648027457353},"id":"62a17ad0-7a95-4116-84ab-135ee088c043","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-1420,360],"typeVersion":1},{"parameters":{"content":"## 4. Create Event and Send Reply Message\n[Read more about using Google Calendar](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googlecalendar)\n\nOnce we have these details, we create the invite and reply to original user message acknowleging the event was created successfully. Note, we also use this reply to avoid duplicates!","height":414.62723127587867,"width":492.07150832656214,"color":7},"id":"15e973c9-d92c-42a2-be99-dd27c2cc42f1","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[740,160],"typeVersion":1},{"parameters":{"select":"channel","channelId":{"__rl":true,"mode":"id","value":"={{ $('Should Create Event?').item.json.channel.id }}"},"text":"=Event Created!\nAdd to Calendar: {{ $json.htmlLink }}\n#event{{ $json.id }}","otherOptions":{"thread_ts":{"replyValues":{"thread_ts":"={{ $('Should Create Event?').item.json.invite.json.ts }}"}}}},"id":"8136ff2b-fea3-4577-853e-323f56a910a6","name":"Reply Invite with EventId","type":"n8n-nodes-base.slack","position":[1020,360],"typeVersion":2.2,"webhookId":"16ae74d3-344f-4b6c-bf4d-83f21be03601"},{"parameters":{"agent":"openAiFunctionsAgent","promptType":"define","text":"=Your role is to create professional event calendar events based on user message.\nGiven the following user message, do the following 5 tasks. Note, Assume all dates are within the current year which is {{ $now.format(\"yyyy\") }} unless stated otherwise.\n1. Summarize the message and generate a title for the event. Make sure it's eye-catching to attract more attendees!\n2. Determine and extract the start date and time for the event. Date must be in the format yyyy-MM-dd and time in the format of hh:mm:ss. If no start time is indicated, the start time is 9am. If you are unable to do so, just leave it blank.\n3. Determine and extract the end date and time for the event. Date must be in the format yyyy-MM-dd and time in the format of hh:mm:ss. If you are unable to do so, just leave it blank.\n4. Where the user message refers to a location or venue, use the SerpAPI tool to search for this location or venue on the web and retrieve the full address.\n5. Additionally, if the location or venue has a website or relevant webpage, return the URL of the location or venue.\n6. Try to identify the event type as one of \"social meeting\", \"social gathering\", \"business meeting\", \"business gathering\" or \"unknown\".\n\nuser message:\n```{{ $json.invite.json.text }}```","hasOutputParser":true,"options":{}},"id":"c27d8288-8958-49ee-a865-3ef41e2459d9","name":"Calendar Event Booking Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[280,300],"typeVersion":1.5},{"parameters":{"content":"### Part 1: Creating the Event\nThis branch runs when we have a new Event.","height":80,"width":394.45954589267495,"color":5},"id":"ff56759f-39a4-41de-b437-1fad9d9460b2","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[120,-80],"typeVersion":1},{"parameters":{"content":"### Part 2: Adding Attendees to Event\nThis branch runs if the event already exists.","height":80,"width":394.45954589267495,"color":5},"id":"f00090f2-03ec-40ec-96ef-678c0d9b158e","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[160,700],"typeVersion":1},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n🚨**Required**\n* Set the channel to monitor here. Also, make sure to use the user access token in your credential","height":362.21121634583966,"width":179.82769272818715},"id":"a23a3702-f778-4411-a722-e203bd10a68e","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[-720,660],"typeVersion":1},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n🚨**Required**\n* Set the Google Calendar to use here.","height":317.6738512911155,"width":179.82769272818715},"id":"84066540-407a-43f7-bce9-afbe9c9d3914","name":"Sticky Note10","type":"n8n-nodes-base.stickyNote","position":[880,420],"typeVersion":1}],"connections":{"SerpAPI":{"ai_tool":[[{"node":"Calendar Event Booking Agent","type":"ai_tool","index":0}]]},"Get User":{"main":[[{"node":"Should Add Attendee?","type":"main","index":0}]]},"Wikipedia":{"ai_tool":[[{"node":"Calendar Event Booking Agent","type":"ai_tool","index":0}]]},"Create Event":{"main":[[{"node":"Reply Invite with EventId","type":"main","index":0}]]},"Is Attending":{"main":[[{"node":"For Each User ID...","type":"main","index":0}]]},"Get User Email":{"main":[[{"node":"Add Attendee to Event","type":"main","index":0}]]},"Get Old EventId":{"main":[[{"node":"Get Event Details","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Search for Invite Requests","type":"main","index":0}]]},"Get Event Details":{"main":[[{"node":"Get Invite Reactions","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Calendar Event Booking Agent","type":"ai_languageModel","index":0}]]},"Get Invite Replies":{"main":[[{"node":"Get Existing Invite EventID","type":"main","index":0}]]},"For Each User ID...":{"main":[[{"node":"Get User","type":"main","index":0}]]},"Get Invite Reactions":{"main":[[{"node":"Extract Invite Reactions","type":"main","index":0}]]},"Should Add Attendee?":{"main":[[{"node":"Get User Email","type":"main","index":0}]]},"Should Create Event?":{"main":[[{"node":"Calendar Event Booking Agent","type":"main","index":0}],[{"node":"Get Old EventId","type":"main","index":0}]]},"Extract Invite Reactions":{"main":[[{"node":"Is Attending","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Calendar Event Booking Agent","type":"ai_outputParser","index":0}]]},"Search for Invite Requests":{"main":[[{"node":"Get Invite Replies","type":"main","index":0}]]},"Get Existing Invite EventID":{"main":[[{"node":"Should Create Event?","type":"main","index":0}]]},"Calendar Event Booking Agent":{"main":[[{"node":"Create Event","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"25b0ad3b-9ac0-4121-a020-eed24bd8b67a","triggerCount":0,"tags":[{"createdAt":"2025-02-12T01:27:06.022Z","updatedAt":"2025-02-12T01:27:06.022Z","id":"XinLwiwNst8mTVBz","name":"OFFICE_AUTOMATION"},{"createdAt":"2025-02-11T23:59:41.483Z","updatedAt":"2025-02-14T16:18:26.979Z","id":"dzhL8PxGOvRSKz2J","name":"ANCORA IN TEST"}]}