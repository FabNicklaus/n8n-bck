{"createdAt":"2025-02-28T15:39:18.919Z","updatedAt":"2025-02-28T15:49:12.000Z","id":"8nMq2RQuuEOHvAhe","name":"My workflow","active":false,"nodes":[{"parameters":{},"id":"43e9d2ea-25b8-4ca2-8c84-de0e2ff346af","name":"On clicking 'execute'","type":"n8n-nodes-base.manualTrigger","position":[380,140],"typeVersion":1},{"parameters":{"content":"## Subworkflow","height":751,"width":2547,"color":6},"id":"d00e5d5c-ae89-4445-8048-1e8594655b7f","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-60,520],"typeVersion":1},{"parameters":{"filters":{},"requestOptions":{}},"id":"570ebc5f-0573-4c06-8dc9-3e87ca245175","name":"n8n","type":"n8n-nodes-base.n8n","position":[640,220],"typeVersion":1,"credentials":{"n8nApi":{"id":"e0P2yj9nA0voMJCS","name":"n8n account"}}},{"parameters":{"assignments":{"assignments":[{"id":"8d513345-6484-431f-afb7-7cf045c90f4f","name":"Done","type":"boolean","value":true}]},"options":{}},"id":"fd21f057-62f7-4e6c-9d99-e6b4ffc922ac","name":"Return","type":"n8n-nodes-base.set","position":[2280,720],"typeVersion":3.3},{"parameters":{"url":"={{ $json.download_url }}","options":{}},"id":"1425b728-89d2-44a0-a6a0-4f0b2af072ce","name":"Get File","type":"n8n-nodes-base.httpRequest","position":[1380,600],"typeVersion":4.2},{"parameters":{"conditions":{"options":{"version":1,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"45ce825e-9fa6-430c-8931-9aaf22c42585","operator":{"type":"string","operation":"empty","singleValue":true},"leftValue":"={{ $json.content }}","rightValue":""},{"id":"9619a55f-7fb1-4f24-b1a7-7aeb82365806","operator":{"type":"string","operation":"notExists","singleValue":true},"leftValue":"={{ $json.error }}","rightValue":""}]},"options":{}},"id":"f5c690b8-d367-466d-8745-d3b446ba22fe","name":"If file too large","type":"n8n-nodes-base.if","position":[1180,620],"typeVersion":2},{"parameters":{},"id":"d70273a2-56b6-4970-84e8-319fef5ff893","name":"Merge Items","type":"n8n-nodes-base.merge","position":[1180,880],"typeVersion":2},{"parameters":{"jsCode":"const orderJsonKeys = (jsonObj) => {\n  const ordered = {};\n  Object.keys(jsonObj).sort().forEach(key => {\n    ordered[key] = jsonObj[key];\n  });\n  return ordered;\n}\n\n// Check if file returned with content\nif (Object.keys($input.all()[0].json).includes(\"content\")) {\n  // Decode base64 content and parse JSON\n  const origWorkflow = JSON.parse(Buffer.from($input.all()[0].json.content, 'base64').toString());\n  const n8nWorkflow = $input.all()[1].json;\n  \n  // Order JSON objects\n  const orderedOriginal = orderJsonKeys(origWorkflow);\n  const orderedActual = orderJsonKeys(n8nWorkflow);\n\n  // Determine difference\n  if (JSON.stringify(orderedOriginal) === JSON.stringify(orderedActual)) {\n    $input.all()[0].json.github_status = \"same\";\n  } else {\n    $input.all()[0].json.github_status = \"different\";\n    $input.all()[0].json.n8n_data_stringy = JSON.stringify(orderedActual, null, 2);\n  }\n  $input.all()[0].json.content_decoded = orderedOriginal;\n// No file returned / new workflow\n} else if (Object.keys($input.all()[0].json).includes(\"data\")) {\n  const origWorkflow = JSON.parse($input.all()[0].json.data);\n  const n8nWorkflow = $input.all()[1].json;\n  \n  // Order JSON objects\n  const orderedOriginal = orderJsonKeys(origWorkflow);\n  const orderedActual = orderJsonKeys(n8nWorkflow);\n\n  // Determine difference\n  if (JSON.stringify(orderedOriginal) === JSON.stringify(orderedActual)) {\n    $input.all()[0].json.github_status = \"same\";\n  } else {\n    $input.all()[0].json.github_status = \"different\";\n    $input.all()[0].json.n8n_data_stringy = JSON.stringify(orderedActual, null, 2);\n  }\n  $input.all()[0].json.content_decoded = orderedOriginal;\n\n} else {\n  // Order JSON object\n  const n8nWorkflow = $input.all()[1].json;\n  const orderedActual = orderJsonKeys(n8nWorkflow);\n  \n  // Proper formatting\n  $input.all()[0].json.github_status = \"new\";\n  $input.all()[0].json.n8n_data_stringy = JSON.stringify(orderedActual, null, 2);\n}\n\n// Return items\nreturn $input.all();"},"id":"4921fb58-2b1e-48fd-9012-fae323a7e12d","name":"isDiffOrNew","type":"n8n-nodes-base.code","position":[1380,880],"typeVersion":1},{"parameters":{"dataType":"string","value1":"={{$json.github_status}}","rules":{"rules":[{"value2":"same"},{"value2":"different","output":1},{"value2":"new","output":2}]}},"id":"817f4c75-406c-4c7b-873a-d18527aa7361","name":"Check Status","type":"n8n-nodes-base.switch","position":[1600,880],"typeVersion":1},{"parameters":{},"id":"9349337b-13ea-43c9-9e2c-34a478fb3774","name":"Same file - Do nothing","type":"n8n-nodes-base.noOp","position":[1820,720],"typeVersion":1},{"parameters":{},"id":"ec7a15c8-7e31-4a51-b64b-c5d6aa2087bb","name":"File is different","type":"n8n-nodes-base.noOp","position":[1820,880],"typeVersion":1},{"parameters":{},"id":"b8a7490f-788b-40ac-955d-c49547632cc7","name":"File is new","type":"n8n-nodes-base.noOp","position":[1820,1040],"typeVersion":1},{"parameters":{"resource":"file","owner":{"__rl":true,"mode":"name","value":"={{ $('Globals').item.json.repo.owner }}"},"repository":{"__rl":true,"mode":"name","value":"={{ $('Globals').item.json.repo.name }}"},"filePath":"={{ $('Globals').item.json.repo.path }}{{$('Execute Workflow Trigger').first().json.id}}.json","fileContent":"={{$('isDiffOrNew').item.json[\"n8n_data_stringy\"]}}","commitMessage":"={{$('Execute Workflow Trigger').first().json.name}} ({{$json.github_status}})"},"id":"c8ba60db-23fa-48b8-a9c2-b2799aa4e47f","name":"Create new file","type":"n8n-nodes-base.github","position":[2040,1040],"typeVersion":1,"credentials":{"githubApi":{"id":"d8Aca1Kz6HhErvT5","name":"GitHub account"}}},{"parameters":{"resource":"file","operation":"edit","owner":{"__rl":true,"mode":"name","value":"={{ $('Globals').item.json.repo.owner }}"},"repository":{"__rl":true,"mode":"name","value":"={{ $('Globals').item.json.repo.name }}"},"filePath":"={{ $('Globals').item.json.repo.path }}{{$('Execute Workflow Trigger').first().json.id}}.json","fileContent":"={{$('isDiffOrNew').item.json[\"n8n_data_stringy\"]}}","commitMessage":"={{$('Execute Workflow Trigger').first().json.name}} ({{$json.github_status}})"},"id":"e9a3ddab-fa88-4b91-a841-31b13a0ef09a","name":"Edit existing file","type":"n8n-nodes-base.github","position":[2040,860],"typeVersion":1,"credentials":{"githubApi":{"id":"d8Aca1Kz6HhErvT5","name":"GitHub account"}}},{"parameters":{"options":{}},"id":"322244e6-ed46-4a27-8a0c-6f802541def9","name":"Loop Over Items","type":"n8n-nodes-base.splitInBatches","position":[840,240],"typeVersion":3},{"parameters":{"rule":{"interval":[{"triggerAtHour":7}]}},"id":"ef9a288e-96d7-4bc4-8aff-3b92cc0a019f","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","position":[380,340],"typeVersion":1.2},{"parameters":{"content":"## Backup to GitHub \nThis workflow will backup all instance workflows to GitHub.\n\nThe files are saved `ID.json` for the filename.\n\n### Setup\nOpen `Globals` node and update the values below ðŸ‘‡\n\n- **repo.owner:** your Github username\n- **repo.name:** the name of your repository\n- **repo.path:** the folder to use within the repository. If it doesn't exist it will be created.\n\n\nIf your username was `john-doe` and your repository was called `n8n-backups` and you wanted the workflows to go into a `workflows` folder you would set:\n\n- repo.owner - john-doe\n- repo.name - n8n-backups\n- repo.path - workflows/\n\n\nThe workflow calls itself using a subworkflow, to help reduce memory usage.","height":600.88409546716,"width":371.1995072042308,"color":4},"id":"07604073-537d-4faa-87b3-8b4b9071eb81","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-60,-120],"typeVersion":1},{"parameters":{"content":"## Main workflow loop","height":434.88564057365943,"width":886.4410237965205,"color":7},"id":"abc9abad-ec5f-47ce-b6d9-d2ee4a374cf8","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[340,60],"typeVersion":1},{"parameters":{"resource":"file","operation":"get","owner":{"__rl":true,"mode":"name","value":"={{ $json.repo.owner }}"},"repository":{"__rl":true,"mode":"name","value":"={{ $json.repo.name }}"},"filePath":"={{ $json.repo.path }}{{ $('Execute Workflow Trigger').item.json.id }}.json","asBinaryProperty":false,"additionalParameters":{}},"id":"4f841b27-c4a3-43a2-9d78-a699da5b7478","name":"Get file data","type":"n8n-nodes-base.github","position":[980,620],"typeVersion":1,"alwaysOutputData":true,"credentials":{"githubApi":{"id":"d8Aca1Kz6HhErvT5","name":"GitHub account"}},"continueOnFail":true},{"parameters":{"assignments":{"assignments":[{"id":"6cf546c5-5737-4dbd-851b-17d68e0a3780","name":"repo.owner","type":"string","value":"Fabnicklaus"},{"id":"452efa28-2dc6-4ea3-a7a2-c35d100d0382","name":"repo.name","type":"string","value":"n8n-bck"},{"id":"81c4dc54-86bf-4432-a23f-22c7ea831e74","name":"repo.path","type":"string","value":"=workflows/{{ $json.tags[0].name }}"}]},"options":{}},"id":"71d88ef3-5b93-4eaf-87c8-4d319298c216","name":"Globals","type":"n8n-nodes-base.set","position":[760,780],"typeVersion":3.4},{"parameters":{"content":"## Edit this node ðŸ‘‡","height":80,"width":150,"color":4},"id":"d37766cc-a6e3-46d6-a4c0-38cd3bae9ed9","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[740,660],"typeVersion":1},{"parameters":{"inputSource":"passthrough"},"id":"d4df16ad-e98f-427a-9508-2c69041fc193","name":"Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","position":[40,960],"typeVersion":1.1},{"parameters":{"workflowId":{"__rl":true,"mode":"id","value":"={{ $workflow.id }}"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{}},"id":"34e073e5-d263-4d52-8bbf-c6def6763add","name":"Execute Workflow","type":"n8n-nodes-base.executeWorkflow","position":[1060,220],"typeVersion":1.2},{"parameters":{"assignments":{"assignments":[{"id":"12cad226-e091-4bbb-aed9-a8e01311772c","name":"tags[0].name","type":"string","value":"={{ $('Execute Workflow Trigger').item.json.tags[0].name }}/"}]},"options":{}},"id":"159b11cb-029f-4d6b-b0be-e608f655523d","name":"/","type":"n8n-nodes-base.set","position":[520,680],"typeVersion":3.4},{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"object","operation":"exists","singleValue":true},"leftValue":"={{ $json.tags[0] }}","rightValue":""}]},"renameOutput":true,"outputKey":"tag"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"2656fbe3-fe35-4770-9c03-9a455ec618e4","operator":{"type":"object","operation":"notExists","singleValue":true},"leftValue":"={{ $json.tags[0] }}","rightValue":""}]},"renameOutput":true,"outputKey":"none"}]},"options":{}},"id":"bff34820-9d51-404d-b9ad-a34bfd395d3a","name":"tag?","type":"n8n-nodes-base.switch","position":[280,780],"typeVersion":3.2}],"connections":{"/":{"main":[[{"node":"Globals","type":"main","index":0}]]},"n8n":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"tag?":{"main":[[{"node":"/","type":"main","index":0}],[{"node":"Globals","type":"main","index":0}]]},"Globals":{"main":[[{"node":"Get file data","type":"main","index":0}]]},"Get File":{"main":[[{"node":"Merge Items","type":"main","index":0}]]},"File is new":{"main":[[{"node":"Create new file","type":"main","index":0}]]},"Merge Items":{"main":[[{"node":"isDiffOrNew","type":"main","index":0}]]},"isDiffOrNew":{"main":[[{"node":"Check Status","type":"main","index":0}]]},"Check Status":{"main":[[{"node":"Same file - Do nothing","type":"main","index":0}],[{"node":"File is different","type":"main","index":0}],[{"node":"File is new","type":"main","index":0}]]},"Get file data":{"main":[[{"node":"If file too large","type":"main","index":0}]]},"Create new file":{"main":[[{"node":"Return","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Execute Workflow","type":"main","index":0}]]},"Execute Workflow":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"n8n","type":"main","index":0}]]},"File is different":{"main":[[{"node":"Edit existing file","type":"main","index":0}]]},"If file too large":{"main":[[{"node":"Get File","type":"main","index":0}],[{"node":"Merge Items","type":"main","index":0}]]},"Edit existing file":{"main":[[{"node":"Return","type":"main","index":0}]]},"On clicking 'execute'":{"main":[[{"node":"n8n","type":"main","index":0}]]},"Same file - Do nothing":{"main":[[{"node":"Return","type":"main","index":0}]]},"Execute Workflow Trigger":{"main":[[{"node":"Merge Items","type":"main","index":1},{"node":"tag?","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"d9a589ed-1d23-43fb-8e66-ec66c2a3e5df","triggerCount":0,"tags":[]}